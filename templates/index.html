<!DOCTYPE html>
<html>
<head>
    <title>Image Enhancer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <div class="p-5 mt-4 mb-4 bg-light rounded-3">
          <h1 class="display-5 fw-bold">Image Enhancer</h1>
          <p class="fs-4">
            Transform your low-resolution images into stunning high-quality masterpieces with ease using our Flask web application. Powered by AI image upscaling technology, it effortlessly enhances the details and sharpness of your images. Elevate your visual content and impress your audience with every click.
          </p>
          <hr class="my-4">
          <form class="row g-8 col-auto" action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data">
            <div class="col-auto">
                <label for="image" class="form-control-plaintext">Upload Image:</label>
            </div>
            <div class="col-8">
              <input type="file" class="form-control" name="image" id="image-input" onchange="previewImage();" accept=".jpg,.jpeg,.png">
            </div>
            <div class="col-auto">
                <input type="submit" class="btn btn-primary mb-3" value="Enhance Image">
            </div>
          </form>
          <div class="row mt-5">
            <div class="col-md-6 text-center">
              <h3 class="mb-3">Original Image:</h3>
              <div id="original" class="placeholder-glow"></div>
            </div>
            <div class="col-md-6 text-center">
              <h3 class="mb-3">Enhanced Image:</h3>
              <div id="enhanced" class="placeholder-glow"></div>
            </div>
          </div>
        </div>
      </div>      
    <script>
      const form = document.querySelector('form');
      const fileInput = document.getElementById('image-input');
      const original = document.getElementById('original');
      const enhanced = document.getElementById('enhanced');
      const submitBtn = form.querySelector('input[type="submit"]');

      fileInput.addEventListener('change', () => {
        original.innerHTML = '';
        enhanced.innerHTML = '';
        const file = fileInput.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          const img = document.createElement('img');
          img.className = 'img-fluid border rounded';
          img.onload = () => {};
          img.src = reader.result;
          original.appendChild(img);
        };
        reader.readAsDataURL(file);
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        enhanced.innerHTML = '';
        const file = fileInput.files[0];
        if (!file) { alert('Выберите файл'); return; }

        const fd = new FormData();
        fd.append('image', file);

        submitBtn.disabled = true;
        const spinner = document.createElement('div');
        spinner.className = 'spinner-border text-primary';
        enhanced.appendChild(spinner);

        try {
          const res = await fetch('/upload', { method: 'POST', body: fd });

          if (!res.ok) {
          const text = await res.text().catch(() => '');
          throw new Error(text || `HTTP ${res.status}`);
          }

          const blob = await res.blob();
          const url = URL.createObjectURL(blob);

          const img = document.createElement('img');
          img.className = 'img-fluid border rounded';
          img.onload = () => URL.revokeObjectURL(url);
          img.src = url;

          enhanced.innerHTML = '';
          enhanced.appendChild(img);
        } catch (err) {
          enhanced.innerHTML = '';
          const alertDiv = document.createElement('div');
          alertDiv.className = 'alert alert-danger';
          alertDiv.textContent = 'Ошибка: ' + err.message;
          enhanced.appendChild(alertDiv);
        } finally {
          submitBtn.disabled = false;
        }
      });
    </script>
</body>
</html>